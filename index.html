<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Integrasi Blockchain, AI & Geotagging</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.0/lucide.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        .node { stroke: #fff; stroke-width: 2px; transition: r 0.3s ease; }
        .link { stroke: #94a3b8; stroke-opacity: 0.6; stroke-width: 1.5px; }
        .tooltip { position: absolute; pointer-events: none; transition: opacity 0.2s; }
        .glass-panel { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(226, 232, 240, 0.8); }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        
        /* Fix getar/jitter: matikan pointer events pada label saat drag */
        .dragging text { pointer-events: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 h-screen flex flex-col">

    <!-- Header & Navigasi -->
    <header class="glass-panel px-6 py-4 flex justify-between items-center z-50">
        <div class="flex items-center gap-3">
            <div class="bg-blue-600 p-2 rounded-lg text-white">
                <i data-lucide="shield-check"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg leading-none">IntegritySystem v2.0</h1>
                <p class="text-xs text-slate-500 uppercase tracking-wider font-semibold">Monitoring Belanja Negara</p>
            </div>
        </div>
        
        <nav class="flex gap-6">
            <button onclick="switchTab('visualizer')" id="btn-visualizer" class="flex items-center gap-2 font-medium tab-active transition-all py-2 px-1">
                <i data-lucide="network" class="w-4 h-4"></i> Visualisasi
            </button>
            <button onclick="switchTab('transactions')" id="btn-transactions" class="flex items-center gap-2 font-medium text-slate-500 hover:text-blue-600 transition-all py-2 px-1">
                <i data-lucide="database" class="w-4 h-4"></i> Transaksi Blockchain
            </button>
            <button onclick="toggleHelp()" class="flex items-center gap-2 font-medium text-slate-500 hover:text-blue-600 transition-all py-2 px-1">
                <i data-lucide="help-circle" class="w-4 h-4"></i> Pusat Bantuan
            </button>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 relative overflow-hidden">
        
        <!-- Tab 1: Visualizer -->
        <div id="tab-visualizer" class="absolute inset-0 block">
            <div id="canvas-container" class="w-full h-full cursor-grab active:cursor-grabbing"></div>
            
            <!-- Side Info Panel -->
            <div class="absolute top-6 left-6 w-80 flex flex-col gap-4">
                <div class="glass-panel rounded-2xl p-5 shadow-sm">
                    <h3 class="font-bold text-slate-800 mb-2 flex items-center gap-2">
                        <i data-lucide="activity" class="text-blue-500 w-4 h-4"></i> Status AI
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-slate-500">Akurasi Deteksi</span>
                            <span class="font-semibold text-green-600">98.4%</span>
                        </div>
                        <div class="w-full bg-slate-200 rounded-full h-1.5">
                            <div class="bg-green-500 h-1.5 rounded-full" style="width: 98%"></div>
                        </div>
                        <p class="text-xs text-slate-500 italic">"Tidak ditemukan anomali mayor pada siklus anggaran saat ini."</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab 2: Transactions List -->
        <div id="tab-transactions" class="absolute inset-0 hidden bg-white overflow-y-auto p-8">
            <div class="max-w-6xl mx-auto">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h2 class="text-3xl font-extrabold text-slate-900">Buku Besar Transaksi</h2>
                        <p class="text-slate-500">Data real-time dari Ledger Blockchain Pemerintah</p>
                    </div>
                    <div class="bg-blue-50 px-4 py-2 rounded-lg border border-blue-100 flex items-center gap-3">
                        <span class="relative flex h-3 w-3">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-blue-500"></span>
                        </span>
                        <span class="text-sm font-medium text-blue-700">Syncing Block #842,102</span>
                    </div>
                </div>

                <div class="overflow-hidden border border-slate-200 rounded-xl shadow-sm">
                    <table class="w-full text-left border-collapse bg-white">
                        <thead>
                            <tr class="bg-slate-50 border-bottom border-slate-200">
                                <th class="px-6 py-4 text-xs font-bold uppercase text-slate-500 tracking-wider">Tanggal & Waktu</th>
                                <th class="px-6 py-4 text-xs font-bold uppercase text-slate-500 tracking-wider">Program / Instansi</th>
                                <th class="px-6 py-4 text-xs font-bold uppercase text-slate-500 tracking-wider text-right">Nilai Transaksi</th>
                                <th class="px-6 py-4 text-xs font-bold uppercase text-slate-500 tracking-wider">Blockchain Hash</th>
                                <th class="px-6 py-4 text-xs font-bold uppercase text-slate-500 tracking-wider">Status</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-body" class="divide-y divide-slate-100">
                            <!-- Data diisi via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <!-- Overlay: Pusat Bantuan -->
    <div id="help-modal" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden animate-in fade-in zoom-in duration-200">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <i data-lucide="help-circle" class="text-blue-500"></i> Pusat Bantuan
                </h3>
                <button onclick="toggleHelp()" class="p-2 hover:bg-slate-200 rounded-full transition-colors">
                    <i data-lucide="x" class="w-5 h-5 text-slate-500"></i>
                </button>
            </div>
            <div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
                <div class="space-y-2">
                    <h4 class="font-bold text-slate-800">Bagaimana cara membaca visualisasi?</h4>
                    <p class="text-sm text-slate-600">Setiap lingkaran (node) mewakili entitas atau program. Hubungan (garis) menunjukkan aliran dana. Warna merah menandakan anomali yang dideteksi oleh AI.</p>
                </div>
                <div class="space-y-2">
                    <h4 class="font-bold text-slate-800">Apa itu Blockchain Hash?</h4>
                    <p class="text-sm text-slate-600">ID unik yang tidak dapat diubah untuk setiap transaksi. Anda dapat memverifikasi keaslian data dengan mengeklik hash tersebut di menu Transaksi.</p>
                </div>
                <div class="space-y-2">
                    <h4 class="font-bold text-slate-800">Bug Jitter/Getar</h4>
                    <p class="text-sm text-slate-600 text-blue-600 font-medium italic">Update: Masalah getar pada node saat diklik telah diperbaiki dengan mengunci posisi simulasi saat interaksi pengguna dilakukan.</p>
                </div>
                <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-100 text-xs text-yellow-800">
                    Sistem ini merupakan prototipe integrasi Blockchain, AI, dan Geotagging untuk pengawasan belanja negara yang transparan.
                </div>
            </div>
            <div class="p-4 bg-slate-50 flex justify-end">
                <button onclick="toggleHelp()" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-blue-700">Tutup</button>
            </div>
        </div>
    </div>

    <script>
        // Mock Data Transaksi
        const transactions = [
            { date: '2025-10-24 09:15:22', program: 'Pembangunan Jembatan Desa A', amount: 'Rp 4.500.000.000', hash: '0x74a...8e21', status: 'Verified' },
            { date: '2025-10-24 11:30:05', program: 'Pengadaan Alat Kesehatan RSUD', amount: 'Rp 1.250.000.000', hash: '0x1c9...b4f3', status: 'Verified' },
            { date: '2025-10-23 14:45:10', program: 'Subsidi Pupuk Petani Lokal', amount: 'Rp 890.000.000', hash: '0xfa3...22c1', status: 'Verified' },
            { date: '2025-10-23 16:20:45', program: 'Beasiswa Pendidikan Tinggi', amount: 'Rp 2.100.000.000', hash: '0x9db...7a4e', status: 'Warning', flag: true },
            { date: '2025-10-22 08:10:33', program: 'Perbaikan Irigasi Sawah', amount: 'Rp 560.000.000', hash: '0x334...ff1a', status: 'Verified' }
        ];

        // Inisialisasi Lucide Icons
        lucide.createIcons();

        // Fungsi Tab Switching
        function switchTab(tab) {
            const tabs = ['visualizer', 'transactions'];
            tabs.forEach(t => {
                document.getElementById(`tab-${t}`).classList.add('hidden');
                document.getElementById(`btn-${t}`).classList.remove('tab-active', 'text-blue-600');
                document.getElementById(`btn-${t}`).classList.add('text-slate-500');
            });
            
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
            document.getElementById(`btn-${tab}`).classList.add('tab-active', 'text-blue-600');
            document.getElementById(`btn-${tab}`).classList.remove('text-slate-500');
        }

        // Fungsi Modal Bantuan
        function toggleHelp() {
            const modal = document.getElementById('help-modal');
            modal.classList.toggle('hidden');
            modal.classList.toggle('flex');
        }

        // Render Tabel Transaksi
        const tableBody = document.getElementById('transaction-body');
        transactions.forEach(tx => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="px-6 py-4 text-sm font-medium text-slate-700">${tx.date}</td>
                <td class="px-6 py-4 text-sm text-slate-600">${tx.program}</td>
                <td class="px-6 py-4 text-sm text-slate-900 font-bold text-right">${tx.amount}</td>
                <td class="px-6 py-4 text-xs font-mono text-blue-500 bg-blue-50/50 rounded p-1">${tx.hash}</td>
                <td class="px-6 py-4">
                    <span class="px-2.5 py-1 rounded-full text-xs font-bold ${tx.flag ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                        ${tx.status}
                    </span>
                </td>
            `;
            tableBody.appendChild(row);
        });

        // D3 Visualizer Logic
        const width = window.innerWidth;
        const height = window.innerHeight;

        const data = {
            nodes: [
                { id: "APBN", group: 1, size: 25 },
                { id: "Kemenkes", group: 2, size: 18 },
                { id: "KemenPUPR", group: 2, size: 18 },
                { id: "Kemendikbud", group: 2, size: 18 },
                { id: "RSUD Daerah", group: 3, size: 12 },
                { id: "Kontraktor A", group: 3, size: 12 },
                { id: "Beasiswa Unggul", group: 3, size: 12, anomaly: true }
            ],
            links: [
                { source: "APBN", target: "Kemenkes" },
                { source: "APBN", target: "KemenPUPR" },
                { source: "APBN", target: "Kemendikbud" },
                { source: "Kemenkes", target: "RSUD Daerah" },
                { source: "KemenPUPR", target: "Kontraktor A" },
                { source: "Kemendikbud", target: "Beasiswa Unggul" }
            ]
        };

        const svg = d3.select("#canvas-container")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%")
            .attr("viewBox", [0, 0, width, height]);

        const simulation = d3.forceSimulation(data.nodes)
            .force("link", d3.forceLink(data.links).id(d => d.id).distance(150))
            .force("charge", d3.forceManyBody().strength(-500))
            .force("center", d3.forceCenter(width / 2, height / 2));

        const link = svg.append("g")
            .selectAll("line")
            .data(data.links)
            .join("line")
            .attr("class", "link");

        const node = svg.append("g")
            .selectAll("g")
            .data(data.nodes)
            .join("g")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        node.append("circle")
            .attr("r", d => d.size)
            .attr("fill", d => d.anomaly ? "#ef4444" : "#3b82f6")
            .attr("class", "node");

        node.append("text")
            .attr("dx", d => d.size + 5)
            .attr("dy", 4)
            .text(d => d.id)
            .attr("class", "text-[10px] font-bold fill-slate-700");

        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // FIX GETAR: Dragging Logic yang Menstabilkan Simulasi
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
            d3.select(this).classed("dragging", true);
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
            d3.select(this).classed("dragging", false);
        }

        window.addEventListener('resize', () => {
            svg.attr("width", window.innerWidth).attr("height", window.innerHeight);
        });
    </script>
</body>
</html>
